(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{170:function(e,t,a){e.exports=a(298)},175:function(e,t,a){},298:function(e,t,a){"use strict";a.r(t);var n,r,o=a(0),l=a.n(o),c=a(35),i=a.n(c),u=(a(175),a(39)),s=a(15),m=a(307),d=a(305),p=a(315),h=a(314),y=a(306),v=a(311),f=a(316),E=a(312),b=(a(176),a(36));!function(e){e.Male="\u7537",e.Female="\u5973"}(n||(n={})),function(e){e.Resident="\u4f4f\u9662\u91ab\u5e2b",e.AssistantChiefResident="\u5c0f CR"}(r||(r={}));var g,k=function e(t,a,n,r){Object(b.a)(this,e),this.name=void 0,this.gender=void 0,this.role=void 0,this.schedules=void 0,this.name=t,this.role=a,this.gender=n,this.schedules=r||[]},O=a(57),j=a(38),w=j.Duration.fromObject({days:1}),S=j.Duration.fromObject({month:1});function C(e,t){return function(e,t){for(var a=j.DateTime.fromObject({year:e,month:t}),n=a.plus(S),r=[],o=a;o<n;o=o.plus(w))r.push(o);return r}(e,t).filter(function(e){return 1<=e.weekday&&e.weekday<=5})}!function(e){e.Morning="\u65e9\u4e0a",e.Afternoon="\u4e0b\u5348"}(g||(g={}));var D,W,T=function(){function e(t,a){Object(b.a)(this,e),this.localDate=void 0,this.period=void 0,this.localDate=t.setLocale("zh-TW"),this.period=a}return Object(O.a)(e,[{key:"oddWeek",value:function(){var e=this.localDate.day;return(Math.floor((e-1)/7)+1)%2===1}},{key:"evenWeek",value:function(){return!this.oddWeek()}},{key:"dateStr",value:function(){var e=this.localDate,t=e.weekdayShort.slice(1);return"".concat(e.month,"/").concat(e.day," (").concat(t,")")}},{key:"comparesTo",value:function(e){var t=this.localDate.toMillis()-e.localDate.toMillis();return 0===t&&(t=e.period.localeCompare(this.period)),t}},{key:"toJSON",value:function(){return{localDate:this.localDate.toISODate(),period:this.period}}}]),e}();!function(e){e.At="\u7279\u5b9a\u6642\u9593",e.EvenWeek="\u6bcf\u96d9\u9031",e.OddWeek="\u6bcf\u55ae\u9031",e.Week="\u6bcf\u9031",e.Day="\u6bcf\u5929",e.Period="\u6bcf\u500b\u6642\u6bb5"}(D||(D={})),function(e){e[e.Monday=1]="Monday",e[e.Tuesday=2]="Tuesday",e[e.Wednesday=3]="Wednesday",e[e.Thursday=4]="Thursday",e[e.Friday=5]="Friday"}(W||(W={}));var M,x=[void 0,"\u4e00","\u4e8c","\u4e09","\u56db","\u4e94"];function A(e,t,a){var n=[];if(a.type===D.At){var r=new T(j.DateTime.local(e,t,a.date),a.period);n.push(r)}else if(a.type===D.Period){var o=!0,l=!1,c=void 0;try{for(var i,u=C(e,t)[Symbol.iterator]();!(o=(i=u.next()).done);o=!0)for(var s=i.value,m=0,d=Object.values(g);m<d.length;m++){var p=d[m],h=new T(s,p);n.push(h)}}catch(B){l=!0,c=B}finally{try{o||null==u.return||u.return()}finally{if(l)throw c}}}else if(a.type===D.Day){var y=a.period,v=!0,f=!1,E=void 0;try{for(var b,k=C(e,t)[Symbol.iterator]();!(v=(b=k.next()).done);v=!0){var O=b.value,w=new T(O,y);n.push(w)}}catch(B){f=!0,E=B}finally{try{v||null==k.return||k.return()}finally{if(f)throw E}}}else{var S=a.weekday,W=a.period,M=!0,x=!1,A=void 0;try{for(var P,R=function(e,t,a){return C(e,t).filter(function(e){return e.weekday===a})}(e,t,S)[Symbol.iterator]();!(M=(P=R.next()).done);M=!0){var F=P.value,H=new T(F,W);a.type===D.OddWeek&&H.oddWeek()?n.push(H):a.type===D.EvenWeek&&H.evenWeek()?n.push(H):a.type===D.Week&&n.push(H)}}catch(B){x=!0,A=B}finally{try{M||null==R.return||R.return()}finally{if(x)throw A}}}return n}!function(e){e.MorningSlide="\u6668\u6703\u6295\u5f71\u7247",e.MorningNote="\u6668\u6703\u8a18\u9304",e.PAP="\u62b9\u7247",e.Jingfu="\u666f\u798f",e.W5Slide="\u79d1\u6703\u6295\u5f71\u7247",e.W5Note="\u79d1\u6703\u8a18\u9304",e.OPD="\u9580\u8a3a",e.Other="\u5176\u4ed6"}(M||(M={}));var P=function(){function e(t,a,n){Object(b.a)(this,e),this.type=void 0,this.time=void 0,this.assignee=void 0,this.type=t,this.time=a,this.assignee=n}return Object(O.a)(e,[{key:"comparesTo",value:function(e){var t=this.time.comparesTo(e.time);return 0===t&&(t=this.type.localeCompare(e.type)),t}}]),e}(),R=function(){function e(t,a,n,r,o){Object(b.a)(this,e),this.type=void 0,this.year=void 0,this.month=void 0,this.repeat=void 0,this.assignee=void 0,this.type=t,this.year=a,this.month=n,this.repeat=r,this.assignee=o}return Object(O.a)(e,[{key:"toSchedules",value:function(){var e=this;return A(this.year,this.month,this.repeat).map(function(t){return new P(e.type,t,e.assignee)})}}]),e}(),F=Function.prototype,H=a(52),B=a(308),L=a(144),N=a.n(L),z=function(e){var t=e.year,a=e.month,n=e.repeatType,r=e.value,c=e.onChange,i=void 0===c?F:c,u=Object.keys(g).map(function(e){return{key:e,text:g[e],value:e}}),d=Object.keys(W).filter(function(e){return isNaN(Number(e))}).map(function(e){var t=W[e];return{key:e,text:x[t],value:t}}),p=C(t,a).map(function(e){var t=e.day,a=e.setLocale("zh-TW").weekdayShort.slice(1);return{key:t,text:"".concat(e.month,"/").concat(t," (").concat(a,")"),value:t}}),h=Object(o.useState)(),y=Object(s.a)(h,2),v=y[0],f=y[1],E=function(e,t){f(t.value)},b=Object(o.useState)(),k=Object(s.a)(b,2),O=k[0],j=k[1],w=function(e,t){j(t.value)},S=Object(o.useState)(),T=Object(s.a)(S,2),M=T[0],A=T[1],P=l.a.createElement("noscript",null),R=void 0;return n===D.At?(P=l.a.createElement(l.a.Fragment,null,l.a.createElement(m.a.Select,{compact:!0,key:"date",placeholder:"\u8acb\u9078\u64c7\u65e5\u671f",options:p,value:M,onChange:function(e,t){"number"===typeof t.value&&A(t.value)}}),l.a.createElement(m.a.Select,{compact:!0,key:"period",placeholder:"\u8acb\u9078\u64c7\u6642\u6bb5",options:u,value:v,onChange:E})),void 0!==M&&void 0!==v&&(R={type:n,date:M,period:g[v]})):n===D.EvenWeek?(P=l.a.createElement(l.a.Fragment,null,l.a.createElement(m.a.Select,{compact:!0,key:"weekDay",placeholder:"\u8acb\u9078\u64c7\u661f\u671f\u5e7e",options:d,value:O,onChange:w}),l.a.createElement(m.a.Select,{compact:!0,key:"period",placeholder:"\u8acb\u9078\u64c7\u6642\u6bb5",options:u,value:v,onChange:E})),void 0!==O&&void 0!==v&&(R={type:n,weekday:O,period:g[v]})):n===D.OddWeek?(P=l.a.createElement(l.a.Fragment,null,l.a.createElement(m.a.Select,{compact:!0,key:"weekDay",placeholder:"\u8acb\u9078\u64c7\u661f\u671f\u5e7e",options:d,value:O,onChange:w}),l.a.createElement(m.a.Select,{compact:!0,key:"period",placeholder:"\u8acb\u9078\u64c7\u6642\u6bb5",options:u,value:v,onChange:E})),void 0!==O&&void 0!==v&&(R={type:n,weekday:O,period:g[v]})):n===D.Week?(P=l.a.createElement(l.a.Fragment,null,l.a.createElement(m.a.Select,{compact:!0,key:"weekDay",placeholder:"\u8acb\u9078\u64c7\u661f\u671f\u5e7e",options:d,value:O,onChange:w}),l.a.createElement(m.a.Select,{compact:!0,key:"period",placeholder:"\u8acb\u9078\u64c7\u6642\u6bb5",options:u,value:v,onChange:E})),void 0!==O&&void 0!==v&&(R={type:n,weekday:O,period:g[v]})):n===D.Day?(P=l.a.createElement(m.a.Select,{compact:!0,key:"period",placeholder:"\u8acb\u9078\u64c7\u6642\u6bb5",options:u,value:v,onChange:E}),void 0!==v&&(R={type:n,period:g[v]})):n===D.Period&&(R={type:n}),Object(o.useEffect)(function(){N()(R,r)||i(R)}),P},q=function(e){var t=e.year,a=e.month,n=e.forceType,r=e.positiveButton,c=void 0===r||r,i=e.submitText,u=void 0===i?"\u65b0\u589e\u73ed\u6b21":i,d=e.onSubmit,p=void 0===d?F:d,h=Object.keys(D).map(function(e){return{key:e,text:D[e],value:e}}),y=Object(o.useState)(),v=Object(s.a)(y,2),f=v[0],E=v[1],b=Object.keys(M).map(function(e){return{key:e,text:M[e],value:e}}),g=Object(o.useState)(),k=Object(s.a)(g,2),O=k[0],j=k[1],w=l.a.createElement(l.a.Fragment,null,l.a.createElement("label",null,"\u8981"),l.a.createElement(m.a.Select,{compact:!0,key:"type",placeholder:"\u8acb\u9078\u64c7\u5de5\u4f5c",options:b,value:O,onChange:function(e,t){j(t.value)}}));n&&(O=n,w=null);var S=Object(o.useState)(),C=Object(s.a)(S,2),W=C[0],T=C[1];return l.a.createElement(m.a,{onSubmit:function(){if(void 0!==W&&void 0!==O){var e=new R(M[O],t,a,W);p(e)}}},l.a.createElement(m.a.Group,{inline:!0,style:{justifyContent:"flex-end"}},l.a.createElement(m.a.Select,{compact:!0,key:"repeatType",placeholder:"\u8acb\u91cd\u8907\u983b\u7387",options:h,value:f,onChange:function(e,t){E(t.value)}}),l.a.createElement(z,{year:t,month:a,repeatType:f?D[f]:void 0,value:W,onChange:function(e){return T(e)}}),w,l.a.createElement(m.a.Button,{positive:c},u)))},J=function(e){var t=e.year,a=e.month,n=e.value,r=e.onChange,o=void 0===r?F:r,c=n.map(function(e,t){var a=e.type,r=e.repeat,c=Object.values(r).join(" ");return l.a.createElement(B.a.Row,{key:c+a},l.a.createElement(B.a.Cell,null,c),l.a.createElement(B.a.Cell,null,a),l.a.createElement(B.a.Cell,{collapsing:!0},l.a.createElement(E.a,{icon:"delete",size:"mini",onClick:function(){var e=n.slice();e.splice(t,1),o(e)}})))});return l.a.createElement(l.a.Fragment,null,l.a.createElement(B.a,{singleLine:!0,selectable:!0},l.a.createElement(B.a.Header,null,l.a.createElement(B.a.Row,null,l.a.createElement(B.a.HeaderCell,null,"\u6642\u9593"),l.a.createElement(B.a.HeaderCell,null,"\u5de5\u4f5c"),l.a.createElement(B.a.HeaderCell,{collapsing:!0},""))),l.a.createElement(B.a.Body,null,c)),l.a.createElement(q,{year:t,month:a,onSubmit:function(e){return o([].concat(Object(H.a)(n),[e]))}}))},I=function(e){var t=e.onChange,a=e.value,n=a.map(function(e,n){var r=e.type,o=e.time,c=l.a.createElement(E.a,{icon:"delete",size:"mini",onClick:function(){var e=a.slice();e.splice(n,1),t(e)}});return l.a.createElement(B.a.Row,{key:r+o.localDate.toISODate()+o.period},l.a.createElement(B.a.Cell,null,o.dateStr(),l.a.createElement("small",null," ",o.period)),l.a.createElement(B.a.Cell,null,r),l.a.createElement(B.a.Cell,{collapsing:!0},c))});return l.a.createElement(B.a,{singleLine:!0,selectable:!0},l.a.createElement(B.a.Header,null,l.a.createElement(B.a.Row,null,l.a.createElement(B.a.HeaderCell,null,"\u6642\u9593"),l.a.createElement(B.a.HeaderCell,null,"\u5de5\u4f5c"),l.a.createElement(B.a.HeaderCell,{collapsing:!0},""))),l.a.createElement(B.a.Body,null,n))},G=a(309),U=a(31),X=a(310),Y=a(80),$=function(e){var t=e.year,a=e.month,n=e.person,r=e.occupiedSchedules,o=e.onChange,c=void 0===o?F:o,i=e.onDelete,u=void 0===i?F:i,s=function(e){c([n,e])},m=function(e){s([].concat(Object(H.a)(r),[e]))},d=function(e,t){return e.filter(function(e){return e.type===t}).map(function(e){var t=Object.values(e.repeat).join(" ");return l.a.createElement(G.a.Item,{key:t},t,l.a.createElement(U.a,{name:"delete",onClick:function(){var t=r.slice(),a=t.indexOf(e);t.splice(a,1),s(t)},style:{cursor:"pointer",paddingLeft:"0.4em"}}))})},p=d(r,M.Other),y=d(r,M.OPD);return l.a.createElement(X.a,{as:"section",fluid:!0},l.a.createElement(X.a.Content,null,l.a.createElement(X.a.Header,null,n.name,l.a.createElement("small",{style:{padding:"0.5em"}},"(",n.gender,")"),l.a.createElement(Y.a,{corner:"right"},l.a.createElement(U.a,{name:"delete",style:{cursor:"pointer"},onClick:u}))),l.a.createElement(X.a.Meta,null,n.role)),l.a.createElement(X.a.Content,null,l.a.createElement(h.a,{size:"tiny"},"\u9580\u8a3a\u6642\u9593"),l.a.createElement(G.a,{style:{margin:"0 1em"}},y),l.a.createElement(q,{year:t,month:a,forceType:"OPD",positiveButton:!1,submitText:"\u65b0\u589e\u6642\u9593",onSubmit:m}),l.a.createElement(h.a,{size:"tiny"},"\u5176\u4ed6\u4e0d\u80fd\u6392\u73ed\u6642\u9593"),l.a.createElement(G.a,{style:{margin:"0 1em"}},p),l.a.createElement(q,{year:t,month:a,forceType:"Other",positiveButton:!1,submitText:"\u65b0\u589e\u6642\u9593",onSubmit:m})))},K=function(e){var t=e.onSubmit,a=Object.keys(r).map(function(e){return{key:e,text:r[e],value:e}}),c=Object.keys(n).map(function(e){return{key:e,text:n[e],value:e}}),i=Object(o.useState)({}),d=Object(s.a)(i,2),p=d[0],h=d[1],y=p.name?p.name:"";return l.a.createElement(m.a,{onSubmit:function(){p.name&&p.role&&p.gender&&(t(new k(p.name,p.role,p.gender)),h(Object(u.a)({},p,{name:""})))}},l.a.createElement(m.a.Group,{inline:!0,style:{justifyContent:"flex-end"}},l.a.createElement("label",null,"\u52a0\u5165"),l.a.createElement(m.a.Input,{placeholder:"\u8acb\u8f38\u5165\u59d3\u540d",required:!0,value:y,onChange:function(e,t){h(Object(u.a)({},p,{name:t.value}))}}),l.a.createElement(m.a.Select,{placeholder:"\u8acb\u9078\u64c7\u6027\u5225",compact:!0,required:!0,options:c,onChange:function(e,t){h(Object(u.a)({},p,{gender:n[t.value]}))}}),l.a.createElement(m.a.Select,{placeholder:"\u8acb\u9078\u64c7\u8eab\u4efd",compact:!0,required:!0,options:a,onChange:function(e,t){h(Object(u.a)({},p,{role:r[t.value]}))}}),l.a.createElement(m.a.Button,{positive:!0},"\u65b0\u589e\u4eba\u54e1")))},Q=function(e){var t=e.year,a=e.month,n=e.value,r=e.onChange,o=void 0===r?F:r,c=n.map(function(e,r){var c=Object(s.a)(e,2),i=c[0],u=c[1];return l.a.createElement($,{key:i.name,year:t,month:a,person:i,occupiedSchedules:u,onChange:function(e){var t=Object(s.a)(e,2),a=t[0],l=t[1],c=n.slice();c.splice(r,1,[a,l]),o(c)},onDelete:function(){var e=n.slice();e.splice(r,1),o(e)}})});return l.a.createElement(l.a.Fragment,null,c,l.a.createElement(K,{onSubmit:function(e){return o([].concat(Object(H.a)(n),[[e,[]]]))}}))},V=j.DateTime.local(),Z=Array(5).fill(1).map(function(e,t){var a=t+V.year;return{key:a,text:a.toString(),value:a}}),_=Array(12).fill(1).map(function(e,t){var a=t+1;return{key:a,text:a.toString(),value:a}}),ee=function(e){var t=e.year,a=e.month,n=e.setYear,r=e.setMonth;return l.a.createElement(m.a,null,l.a.createElement(m.a.Group,{inline:!0},l.a.createElement(m.a.Select,{compact:!0,placeholder:"\u8acb\u9078\u64c7\u5e74\u4efd",options:Z,value:t,onChange:function(e,t){"number"===typeof t.value&&n(t.value)}}),l.a.createElement("label",null,"\u5e74"),l.a.createElement(m.a.Select,{compact:!0,placeholder:"\u8acb\u9078\u64c7\u6708\u4efd",options:_,value:a,onChange:function(e,t){"number"===typeof t.value&&r(t.value)}}),l.a.createElement("label",null,"\u6708")))},te=function(e,t){return[[new k("\u5b6b\u5c0f\u7f8e",r.AssistantChiefResident,n.Female),[new R(M.OPD,e,t,{type:D.Week,weekday:W.Monday,period:g.Afternoon}),new R(M.Other,e,t,{type:D.Week,weekday:W.Wednesday,period:g.Morning})]],[new k("\u738b\u5c0f\u660e",r.Resident,n.Male),[]]]},ae=function(e,t){return[new R(M.MorningNote,e,t,{type:D.Day,period:g.Morning}),new R(M.MorningSlide,e,t,{type:D.Day,period:g.Morning}),new R(M.Jingfu,e,t,{type:D.Week,weekday:2,period:g.Afternoon}),new R(M.W5Note,e,t,{type:D.Week,weekday:5,period:g.Afternoon}),new R(M.W5Slide,e,t,{type:D.Week,weekday:5,period:g.Afternoon}),new R(M.PAP,e,t,{type:D.Period})]},ne=function(){var e=Object(o.useState)(V.year),t=Object(s.a)(e,2),a=t[0],n=t[1],r=Object(o.useState)(V.plus({month:1}).month),c=Object(s.a)(r,2),i=c[0],m=c[1],b=Object(o.useState)(ae(a,i)),g=Object(s.a)(b,2),O=g[0],j=g[1],w=Object(o.useState)(O.flatMap(function(e){return e.toSchedules()}).sort(function(e,t){return e.comparesTo(t)})),S=Object(s.a)(w,2),C=S[0],D=S[1],W=Object(o.useState)(!1),T=Object(s.a)(W,2),M=T[0],x=T[1],A=function(e){var t=e.flatMap(function(e){return e.toSchedules()}).sort(function(e,t){return e.comparesTo(t)});D(t),j(e)},P=Object(o.useState)(te(a,i)),R=Object(s.a)(P,2),F=R[0],H=R[1],B={marginBottom:"1.5em"},L=Object(o.useState)(!1),N=Object(s.a)(L,2),z=N[0],q=N[1];return l.a.createElement(d.a,{text:!0,style:{margin:20}},l.a.createElement(p.a,{as:"section",basic:!0,style:B},l.a.createElement(h.a,{as:"h2"},"\u9078\u64c7\u6642\u9593"),l.a.createElement(y.a,{hidden:!0}),l.a.createElement(ee,{year:a,month:i,setYear:function(e){A(ae(e,i)),H(te(e,i)),n(e)},setMonth:function(e){A(ae(a,e)),H(te(a,e)),m(e)}})),l.a.createElement(v.a,{as:"section",style:Object(u.a)({padding:"1em"},B)},l.a.createElement(v.a.Title,{active:M,onClick:function(){return x(!M)}},l.a.createElement(h.a,{as:"h2"},M?"\u96b1\u85cf":"\u7de8\u8f2f","\u73ed\u6b21")),l.a.createElement(v.a.Content,{active:!M},"\u9ede\u64ca\u6a19\u984c\u4ee5\u958b\u5553\u7de8\u8f2f\u756b\u9762"),l.a.createElement(v.a.Content,{active:M},l.a.createElement(J,{year:a,month:i,value:O,onChange:A}),l.a.createElement(p.a,{as:"section",basic:!0},l.a.createElement(h.a,{as:"h3"},"\u8a73\u7d30\u73ed\u6b21"),l.a.createElement(y.a,{hidden:!0}),l.a.createElement("p",null,"\u7de8\u8f2f\u4e0a\u65b9\u73ed\u6b21\u5f8c\uff0c\u4e0b\u9762\u8a73\u7d30\u73ed\u6b21\u5c07\u6703\u91cd\u7f6e"),l.a.createElement(I,{value:C,onChange:D})))),l.a.createElement(p.a,{as:"section",basic:!0,style:B},l.a.createElement(h.a,{as:"h2"},"\u53c3\u8207\u8005"),l.a.createElement(y.a,{hidden:!0}),l.a.createElement(Q,{year:a,month:i,value:F,onChange:H})),l.a.createElement(p.a,{as:"section",basic:!0,style:B},l.a.createElement(h.a,{as:"h2"},"\u7522\u751f\u73ed\u8868"),l.a.createElement(y.a,{hidden:!0}),l.a.createElement(f.a,null,l.a.createElement(f.a.Column,{width:4}),l.a.createElement(f.a.Column,{width:8},l.a.createElement(E.a,{positive:!0,fluid:!0,size:"huge",loading:z,onClick:function(){var e=function(){var e=[];F.forEach(function(t){var a=Object(s.a)(t,2),n=a[0],r=a[1];e.push(n),r.forEach(function(e){var t=Object.create(e);Object.assign(t,e),t.assignee=n,n.schedules=n.schedules.concat(t.toSchedules())})});var t={schedules:C,persons:e};return JSON.stringify(t,function(e,t){return"assignee"===e&&t instanceof k?t.name:t})}();q(!0),function(e,t,a,n,r){return new Promise(function(o,l){var c=new XMLHttpRequest;c.open(e,t),c.setRequestHeader("Content-Type",r||"application/json"),c.responseType=n||"blob",c.onload=function(e){e.target&&e.target instanceof XMLHttpRequest?o(e.target):l(e)},c.onerror=l,c.send(a)})}("POST","/schedules",e).then(function(e){q(!1),function(e,t){var a=document.createElement("a");a.href=window.URL.createObjectURL(e),a.download=t,a.dispatchEvent(new MouseEvent("click")),a.remove()}(e.response,"output.xlsx")}).catch(console.error)}},"\u81ea\u52d5\u6392\u73ed")),l.a.createElement(f.a.Column,{width:4}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(l.a.createElement(ne,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[170,1,2]]]);
//# sourceMappingURL=main.5170bf9b.chunk.js.map